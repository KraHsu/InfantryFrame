/*
 *  ┌─────────────────────────────────────────────────────────────┐
 *  │┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐│
 *  ││Esc│!1 │@2 │#3 │$4 │%5 │^6 │&7 │*8 │(9 │)0 │_- │+= │|\ │`~ ││
 *  │├───┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴───┤│
 *  ││ Tab │ Q │ W │ E │ R │ T │ Y │ U │ I │ O │ P │{[ │}] │ BS  ││
 *  │├─────┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴─────┤│
 *  ││ Ctrl │ A │ S │ D │ F │ G │ H │ J │ K │ L │: ;│" '│ Enter  ││
 *  │├──────┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴────┬───┤│
 *  ││ Shift  │ Z │ X │ C │ V │ B │ N │ M │< ,│> .│? /│Shift │Fn ││
 *  │└─────┬──┴┬──┴──┬┴───┴───┴───┴───┴───┴──┬┴───┴┬──┴┬─────┴───┘│
 *  │      │Fn │ Alt │         Space         │ Alt │Win│   HHKB   │
 *  │      └───┴─────┴───────────────────────┴─────┴───┘          │
 *  └─────────────────────────────────────────────────────────────┘
 * 
 * @Date: 2024-01-16 20:40:50
 * @LastEditors: KraHsu && 1191393280@qq.com
 * @LastEditTime: 2024-01-17 01:51:15
 * Copyright (c) 2024 by KraHsu, All Rights Reserved. 
 */

#include "infantry_low_pass_filter.h"

#define PI 3.14159265358979f

namespace infantry {

    LowPassFilter::LowPassFilter(float param) {
        _param.filt_para = param;
    }

    float LowPassFilter::calculate(float val) {
        uint32_t period = HAL_GetTick() - _param.last_tick;
        _param.last_tick = HAL_GetTick();
        if ((_param.filt_para > 0) && (_param.filt_para <= 1)) {
            filtered_val = _param.filt_para * val + (1 - _param.filt_para) * filtered_last_val;
            filtered_last_val = filtered_val;
            if (period > 0) {
                _param.cut_off_frq = _param.filt_para / (2 * PI * (float) period * 0.001f);
            }
            _param.calc_frq = 1000 / (float) period;
            return filtered_val;
        } else {
            return val;
        }
    }
}
